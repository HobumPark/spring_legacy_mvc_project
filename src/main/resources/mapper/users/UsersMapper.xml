<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="resources.mapper.users.UsersMapper">

<!-- 회원 가입-->

<!-- 로그인 -->
<select id="findUserByIdAndPassword" resultType="UserDto">
        SELECT * FROM Users WHERE id = #{id} AND password = #{password};
</select>

<!-- 아이디 중복검사-->
<select id="checkUserIdDuplicate" resultType="boolean">
        SELECT COUNT(*) > 0
        FROM users
        WHERE id = #{id}
</select>

<!-- 회원가입 -->
<insert id="insertUser" parameterType="UserDto">
        INSERT INTO users (id, username, password, email, phone_number, address, role, created_at, updated_at, is_active)
        VALUES (#{id}, #{username}, #{password}, #{email}, #{phoneNumber}, #{address}, #{role}, #{createdAt}, #{updatedAt}, #{isActive})
</insert>

<!-- 회원정보 수정 -->
<!-- 회원정보 수정 쿼리 -->
<update id="updateUserInfo" parameterType="UserDto">
	  UPDATE users
	  SET 
	      email = #{email},
	      phone_number = #{phoneNumber},
	      address = #{address},
	      updated_at = NOW()  <!-- 수정일시 자동 갱신 -->
	  WHERE id = #{id}  <!-- id로 사용자를 찾은 뒤 수정 -->
</update>


<!-- 회원탈퇴 - 비활성화 -->
<!-- 사용자 비활성화 -->
<update id="deactivateUser" parameterType="String">
        UPDATE users
        SET is_active = false, updated_at = NOW()  <!-- 비활성화하고, 수정 일자도 갱신 -->
        WHERE id = #{userId}
</update>
</mapper>